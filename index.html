<!DOCTYPE html>
<html>
<head>
<title>Professional Trading Dashboard</title>
<script src="https://s3.tradingview.com/tv.js"></script>
<style>
body { background:#020617; color:white; font-family:Arial; padding:10px; }
table { width:100%; border-collapse:collapse; font-size:12px; }
td,th { padding:6px; border-bottom:1px solid #1e293b; vertical-align:top; }
.stock { color:#60a5fa; cursor:pointer; font-weight:bold; }
.buy { color:#22c55e; font-weight:bold; }
.sell { color:#ef4444; font-weight:bold; }
.hold { color:#ffffff; }
.expand { background:#0f172a; padding:10px; }
button { background:#1e293b; color:white; border:none; padding:4px 8px; border-radius:5px; font-size:11px; cursor:pointer; margin:2px; }
canvas { background:#020617; border:1px solid #1e293b; }
</style>
</head>
<body>

<h3>ðŸ“Š Live Trading Dashboard</h3>

<table>
<thead>
<tr>
<th>Stock</th>
<th>Close</th>
<th>%</th>
<th>Trade Plan (Intraday)</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<script>
const WORKER = "https://red-tooth-e4f7.lovelyideas-in.workers.dev";

const stocks = ["SBIN","HDFCBANK","TCS","RVNL","IDEA","JPPOWER","CUPID"];

function EMA(v,p=14){let k=2/(p+1),e=v[0];for(let i=1;i<v.length;i++)e=v[i]*k+e*(1-k);return e;}
function RSI(v,p=14){let g=0,l=0;for(let i=v.length-p;i<v.length-1;i++){let d=v[i+1]-v[i];d>0?g+=d:l-=d;}return 100-(100/(1+g/(l||1)));}

function aiScore(rsi,trend){
  let score = 50;
  if(rsi<35) score+=25;
  if(trend) score+=15;
  if(rsi>70) score-=20;
  return Math.max(0,Math.min(100,score));
}

function backtest(closes){
  let trades=0,wins=0;
  for(let i=20;i<closes.length-5;i++){
    trades++;
    if(Math.max(...closes.slice(i+1,i+6)) > closes[i]*1.02) wins++;
  }
  return trades?Math.round(wins/trades*100):0;
}

async function loadData(){
  const tbody = document.getElementById("tbody");
  tbody.innerHTML = "";

  for(const s of stocks){
    const res = await fetch(`${WORKER}?symbol=${s}`);
    const json = await res.json();
    const q = json.chart?.result?.[0]?.indicators?.quote?.[0];
    if(!q) continue;

    const closes = q.close.filter(x=>x);
    const highs = q.high.filter(x=>x);
    const lows = q.low.filter(x=>x);

    const close = closes.at(-1);
    const prev = closes.at(-2);
    const pct = ((close-prev)/prev*100).toFixed(2);

    const rsi = RSI(closes.slice(-30));
    const ema = EMA(closes.slice(-30));
    const trend = close > ema;

    const ai = aiScore(rsi, trend);
    const win = backtest(closes);

    let signal="HOLD", cls="hold";
    let sl="-", tgt="-";

    if(rsi<35){
      signal="BUY"; cls="buy";
      sl=(close*0.97).toFixed(2);
      tgt=(close*1.05).toFixed(2);
    }
    else if(rsi>70){
      signal="SELL"; cls="sell";
      sl=(close*1.03).toFixed(2);
      tgt=(close*0.95).toFixed(2);
    }

    const plan = `<span class="${cls}">
      ${signal} @ ${close.toFixed(2)} |
      SL ${sl} |
      TGT ${tgt} |
      Hold 15â€“60m |
      Win ${win}% |
      AI ${ai}%
    </span>`;

    tbody.innerHTML += `
      <tr onclick="expand('${s}', this)">
        <td class="stock">${s}</td>
        <td>${close.toFixed(2)}</td>
        <td>${pct}%</td>
        <td>${plan}</td>
      </tr>`;
  }
}

function expand(sym,row){
  document.querySelectorAll(".expand").forEach(e=>e.remove());

  const detail = document.createElement("tr");
  detail.className="expand";
  detail.innerHTML = `
    <td colspan="4">
      <div id="tv_${sym}" style="height:300px"></div><br>
      <button onclick="window.open('https://chat.openai.com/?q=Analyze ${sym} stock for intraday trade with entry SL target win%','_blank')">Ask ChatGPT</button>
      <button onclick="window.open('https://x.ai/?q=Analyze ${sym} stock for intraday entry SL target win%','_blank')">Ask Grok</button>
      <button onclick="window.open('https://groww.in/stocks/${sym.toLowerCase()}-ltd','_blank')">Open in Groww</button>
    </td>`;
  row.after(detail);

  new TradingView.widget({
    container_id:`tv_${sym}`,
    symbol:`NSE:${sym}`,
    interval:"15",
    theme:"dark",
    autosize:true
  });
}

loadData();
setInterval(loadData,60000);
</script>
</body>
</html>
