<!DOCTYPE html>
<html>
<head>
<title>Live NSE Dashboard</title>
<style>
body {
  background: linear-gradient(#0f172a,#020617);
  color: white;
  font-family: Arial;
  padding: 15px;
}
input, button {
  background:#1e293b;
  color:white;
  border:none;
  padding:8px 10px;
  border-radius:6px;
}
button { cursor:pointer; }
table {
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}
th, td {
  padding:10px;
  border-bottom:1px solid #1e293b;
  text-align:center;
}
.green{color:#22c55e;font-weight:bold}
.red{color:#ef4444;font-weight:bold}
.yellow{color:#facc15;font-weight:bold}
.chatbtn {
  background:#2563eb;
  padding:6px 10px;
  border-radius:6px;
}
</style>
</head>
<body>

<h2>ðŸ“ˆ Live NSE Stock Dashboard</h2>

Date:
<input type="date" id="datePicker">
<button onclick="loadData()">Submit</button>

<table>
<thead>
<tr>
<th>Stock</th>
<th>Open</th><th>High</th><th>Low</th><th>Close</th>
<th>%</th>
<th>RSI</th><th>EMA</th>
<th>Support</th><th>Resistance</th>
<th>Intraday Call</th>
<th>Delivery</th>
<th>GTT</th>
<th>Ask ChatGPT</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<script>
const API_KEY = "eddc1b73dbe4414d8504b46cc2fb7538";

const stocks = ["SBIN","TCS","RVNL","JPPOWER","HINDCOPPER"];

document.getElementById("datePicker").valueAsDate = new Date();

function EMA(values, p=14){
  const k = 2/(p+1);
  let ema = values[0];
  for(let i=1;i<values.length;i++) ema = values[i]*k + ema*(1-k);
  return ema;
}

function RSI(values, p=14){
  let gains=0, losses=0;
  for(let i=values.length-p;i<values.length-1;i++){
    let diff = values[i+1]-values[i];
    diff>0 ? gains+=diff : losses-=diff;
  }
  let rs = gains/(losses||1);
  return 100-(100/(1+rs));
}

async function fetchData(symbol){
  const url = `https://api.twelvedata.com/time_series?symbol=${symbol}.NSE&interval=1day&outputsize=60&apikey=${API_KEY}`;
  const res = await fetch(url);
  const json = await res.json();
  if(json.status === "error") throw json.message;
  return json.values.reverse();
}

async function loadData(){
  const date = document.getElementById("datePicker").value;
  const tbody = document.getElementById("tbody");
  tbody.innerHTML = "";

  for(const s of stocks){
    try{
      const arr = await fetchData(s);
      const idx = arr.findIndex(x => x.datetime === date);
      if(idx < 20) continue;

      const today = arr[idx];
      const prev = arr[idx-1];

      const open = +today.open;
      const high = +today.high;
      const low = +today.low;
      const close = +today.close;

      const pct = (((close - prev.close)/prev.close)*100).toFixed(2);

      const closes = arr.slice(idx-14, idx+1).map(x=>+x.close);
      const highs = arr.slice(idx-14, idx+1).map(x=>+x.high);
      const lows  = arr.slice(idx-14, idx+1).map(x=>+x.low);

      const ema = EMA(closes).toFixed(2);
      const rsi = RSI(closes).toFixed(1);

      const support = Math.min(...lows).toFixed(2);
      const resistance = Math.max(...highs).toFixed(2);

      let intraday = "NO TRADE";
      let delivery = "HOLD";
      let gtt = "-";
      let sl = "-", target = "-";

      if(rsi < 35){
        intraday = `BUY at ${close}`;
        sl = (close*0.97).toFixed(2);
        target = (close*1.05).toFixed(2);
        gtt = `Buy above ${resistance}`;
        delivery = "BUY";
      }
      else if(rsi > 70){
        intraday = `SELL at ${close}`;
        sl = (close*1.03).toFixed(2);
        target = (close*0.95).toFixed(2);
        gtt = `Sell below ${support}`;
      }

      const chatPrompt = encodeURIComponent(
        `Analyze ${s} stock for intraday trading. Provide entry, SL, target, and strategy.`
      );

      tbody.innerHTML += `
      <tr>
        <td><b>${s}</b></td>
        <td>${open}</td>
        <td>${high}</td>
        <td>${low}</td>
        <td>${close}</td>
        <td class="${pct>=0?'green':'red'}">${pct}%</td>
        <td>${rsi}</td>
        <td>${ema}</td>
        <td>${support}</td>
        <td>${resistance}</td>
        <td>${intraday}<br>SL: ${sl}<br>TGT: ${target}</td>
        <td>${delivery}</td>
        <td>${gtt}</td>
        <td>
          <a target="_blank"
             href="https://chat.openai.com/?q=${chatPrompt}">
             <button class="chatbtn">Ask</button>
          </a>
        </td>
      </tr>`;
    }
    catch(e){
      console.error("Error for", s, e);
    }
  }
}

loadData();
</script>
</body>
</html>
