<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Market Dashboard Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="manifest" href="manifest.json">

<style>
:root {
  --bg:#0f172a; --card:#111827; --border:#1f2937;
  --text:#e5e7eb; --green:#22c55e; --red:#ef4444; --blue:#3b82f6;
}
body { margin:0; font-family:Arial; background:var(--bg); color:var(--text);}
header {background:#020617;padding:12px;border-bottom:1px solid var(--border);}
.topbar {display:flex;gap:20px;font-size:14px;flex-wrap:wrap;}
.badge {background:#1f2937;padding:6px 10px;border-radius:8px;}
.container {padding:16px;}
.card {background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:16px;}
table {width:100%;border-collapse:collapse;}
th,td {padding:10px;border-bottom:1px solid var(--border);text-align:center;}
th {cursor:pointer;}
.pos {color:var(--green);} .neg {color:var(--red);}
.controls {display:flex;gap:10px;margin-bottom:10px;flex-wrap:wrap;}
input,button {padding:8px;border-radius:8px;border:none;}
button {background:#1f2937;color:white;}
button.active {background:var(--blue);}
#chartModal {position:fixed;inset:0;background:#000a;display:none;align-items:center;justify-content:center;}
#chartBox {background:#111827;padding:20px;border-radius:16px;width:90%;max-width:700px;}
</style>
</head>
<body>

<header>
  <div class="topbar">
    <div class="badge" id="nifty">Nifty: --</div>
    <div class="badge" id="sensex">Sensex: --</div>
    <div class="badge" id="usd">USD/INR: --</div>
  </div>
</header>

<div class="container">

<div class="card">
  <div class="controls">
    <input id="search" placeholder="Search stock...">
    <button onclick="setFilter('all')" class="active" id="btn-all">All</button>
    <button onclick="setFilter('gainers')" id="btn-gainers">Gainers</button>
    <button onclick="setFilter('losers')" id="btn-losers">Losers</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>Stock</th>
        <th>Low</th>
        <th>High</th>
        <th>LTP</th>
        <th onclick="sortByChange()">% Change ‚¨ç</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>
</div>

</div>

<!-- Chart Modal -->
<div id="chartModal" onclick="closeChart()">
  <div id="chartBox" onclick="event.stopPropagation()">
    <canvas id="chart"></canvas>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const stocks = ["IDEA","SBIN","TCS","RVNL","JPPOWER","HINDCOPPER","RBLBANK","HDFCBANK"];
let data = [], filter="all", sortAsc=false;

async function fetchQuote(symbol){
 const url=`https://api.allorigins.win/raw?url=https://query1.finance.yahoo.com/v7/finance/quote?symbols=${symbol}.NS`;
 return (await fetch(url)).json();
}

async function load(){
 data=[];
 for(let s of stocks){
  try{
   let r=(await fetchQuote(s)).quoteResponse.result[0];
   data.push({
    s,
    low:r.regularMarketDayLow,
    high:r.regularMarketDayHigh,
    price:r.regularMarketPrice,
    change:r.regularMarketChangePercent
   });
  }catch{}
 }
 render();
}

function render(){
 let q=document.getElementById("search").value.toLowerCase();
 let rows=data.filter(x=>{
  if(q && !x.s.toLowerCase().includes(q)) return false;
  if(filter=="gainers" && x.change<0) return false;
  if(filter=="losers" && x.change>=0) return false;
  return true;
 });

 let tbody=document.getElementById("tbody");
 tbody.innerHTML="";
 rows.forEach(x=>{
  let cls=x.change>=0?"pos":"neg";
  tbody.innerHTML+=`
   <tr onclick="showChart('${x.s}')">
    <td>${x.s}</td>
    <td>${x.low?.toFixed(2)||"-"}</td>
    <td>${x.high?.toFixed(2)||"-"}</td>
    <td>${x.price?.toFixed(2)||"-"}</td>
    <td class="${cls}">${x.change?.toFixed(2)}%</td>
   </tr>`;
 });
}

function setFilter(f){
 filter=f;
 document.querySelectorAll("button").forEach(b=>b.classList.remove("active"));
 document.getElementById("btn-"+f).classList.add("active");
 render();
}

function sortByChange(){
 data.sort((a,b)=>sortAsc?a.change-b.change:b.change-a.change);
 sortAsc=!sortAsc;
 render();
}

document.getElementById("search").oninput=render;

function showChart(sym){
 document.getElementById("chartModal").style.display="flex";
 let ctx=document.getElementById("chart").getContext("2d");
 new Chart(ctx,{
  type:"line",
  data:{labels:["1","2","3","4","5"],datasets:[{label:sym,data:[1,2,1,3,2]}]},
  options:{responsive:true}
 });
}

function closeChart(){document.getElementById("chartModal").style.display="none";}

async function loadMarket(){
 document.getElementById("nifty").innerText="Nifty: "+(await fetchQuote("^NSEI")).quoteResponse.result[0].regularMarketPrice;
 document.getElementById("sensex").innerText="Sensex: "+(await fetchQuote("^BSESN")).quoteResponse.result[0].regularMarketPrice;
 document.getElementById("usd").innerText="USDINR: "+(await fetchQuote("USDINR=X")).quoteResponse.result[0].regularMarketPrice;
}

load();
loadMarket();
setInterval(load,20000);
setInterval(loadMarket,60000);
</script>
</body>
</html>
