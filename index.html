<!DOCTYPE html>
<html>
<head>
<title>Ultimate Trading Dashboard</title>
<style>
body{background:#020617;color:white;font-family:Arial;padding:8px}
table{width:100%;border-collapse:collapse;font-size:11px}
th,td{padding:4px;border-bottom:1px solid #1e293b;text-align:left;vertical-align:top}
.green{color:#22c55e;font-weight:bold}
.red{color:#ef4444;font-weight:bold}
.yellow{color:#facc15;font-weight:bold}
button{background:#1e293b;color:white;border:none;padding:2px 6px;border-radius:4px;font-size:10px;cursor:pointer}
.panel{background:#0f172a;padding:6px;border-radius:6px;margin-bottom:6px}
</style>
</head>
<body>

<h3>ðŸ“Š Pro Trading Dashboard (Live NSE)</h3>

<div class="panel">
<button onclick="loadData()">ðŸ”„ Refresh</button>
</div>

<table>
<thead>
<tr>
<th>Stock</th>
<th>Close</th><th>%</th>
<th>RSI</th><th>EMA20</th><th>SMA50</th><th>VWAP</th>
<th>S1</th><th>S2</th><th>R1</th><th>R2</th>
<th>Intraday (with Groww)</th>
<th>Delivery</th>
<th>GTT</th>
<th>ChatGPT</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<script>
const WORKER = "https://red-tooth-e4f7.lovelyideas-in.workers.dev";

const stocks = [
"SAGILITY","GROWWGOLD","JPPOWER","IDEA","BSE","GROWWSILVER",
"HDFCBANK","SBIN","GREAVESCOT","NTPCGREEN","TCS","KIMS","MON100",
"HARAFIN","RBLBANK","IRIS","MEESHO","HINDCOPPER","RVNL","CUPID"
];

const groww = {
"SAGILITY":"sagility-india-ltd",
"SBIN":"state-bank-of-india",
"HDFCBANK":"hdfc-bank",
"TCS":"tata-consultancy-services",
"IDEA":"vodafone-idea",
"BSE":"bse-ltd",
"CUPID":"cupid-ltd",
"RVNL":"rail-vikas-nigam",
"HINDCOPPER":"hindustan-copper",
"JPPOWER":"jaiprakash-power-ventures",
"RBLBANK":"rbl-bank",
"KIMS":"krishna-institute-medical-sciences",
"GREAVESCOT":"greaves-cotton"
};

function EMA(v,p){let k=2/(p+1),e=v[0];for(let i=1;i<v.length;i++)e=v[i]*k+e*(1-k);return e;}
function SMA(v,p){let arr=v.slice(-p);return arr.reduce((a,b)=>a+b,0)/arr.length;}
function RSI(v,p=14){let g=0,l=0;for(let i=v.length-p;i<v.length-1;i++){let d=v[i+1]-v[i];d>0?g+=d:l-=d;}let rs=g/(l||1);return 100-(100/(1+rs));}

function VWAP(highs,lows,closes,volumes){
  let pv=0,vol=0;
  for(let i=0;i<closes.length;i++){
    let tp=(highs[i]+lows[i]+closes[i])/3;
    pv+=tp*volumes[i];
    vol+=volumes[i];
  }
  return pv/vol;
}

async function loadData(){
  tbody.innerHTML="";
  for(const s of stocks){
    try{
      const res=await fetch(`${WORKER}?symbol=${s}`);
      const json=await res.json();
      const r=json.chart?.result?.[0];
      if(!r) continue;

      const q=r.indicators.quote[0];
      const v=r.indicators.quote[0].volume||[];

      const closes=q.close.filter(x=>x);
      const highs=q.high.filter(x=>x);
      const lows=q.low.filter(x=>x);
      const vols=q.volume?.filter(x=>x) || new Array(closes.length).fill(1);

      const close=closes.at(-1);
      const prev=closes.at(-2);
      const pct=((close-prev)/prev*100).toFixed(2);

      const rsi=RSI(closes.slice(-30));
      const ema20=EMA(closes.slice(-30),20);
      const sma50=SMA(closes,50);
      const vwap=VWAP(highs.slice(-30),lows.slice(-30),closes.slice(-30),vols.slice(-30));

      // tighter S/R using recent structure
      const recentHighs=highs.slice(-10);
      const recentLows=lows.slice(-10);
      const s1=Math.min(...recentLows);
      const s2=Math.min(...lows.slice(-20));
      const r1=Math.max(...recentHighs);
      const r2=Math.max(...highs.slice(-20));

      let intraday="No Trade";
      let delivery="Hold";
      let gtt="Wait";

      if(rsi<38 && close>ema20){
        intraday=`BUY @ ${close.toFixed(2)} | SL ${(close*0.97).toFixed(2)} | TGT ${(close*1.05).toFixed(2)} | Hold 15â€“60m
        <br><a target="_blank" href="https://groww.in/stocks/${groww[s]||s.toLowerCase()+"-ltd"}"><button>Trade</button></a>`;
        delivery=`BUY | Hold 2â€“10 days`;
        gtt=`Buy above ${r1.toFixed(2)}`;
      }

      if(rsi>70){
        intraday=`SELL @ ${close.toFixed(2)} | SL ${(close*1.03).toFixed(2)} | TGT ${(close*0.95).toFixed(2)} | Hold 15â€“60m
        <br><a target="_blank" href="https://groww.in/stocks/${groww[s]||s.toLowerCase()+"-ltd"}"><button>Trade</button></a>`;
        gtt=`Sell below ${s1.toFixed(2)}`;
      }

      const chat=`https://chat.openai.com/?q=Analyze ${s} for intraday, delivery and GTT trade setup`;

      tbody.innerHTML+=`
      <tr>
        <td><b>${s}</b></td>
        <td>${close.toFixed(2)}</td>
        <td class="${pct>=0?'green':'red'}">${pct}%</td>
        <td>${rsi.toFixed(1)}</td>
        <td>${ema20.toFixed(1)}</td>
        <td>${sma50.toFixed(1)}</td>
        <td>${vwap.toFixed(1)}</td>
        <td>${s1.toFixed(1)}</td><td>${s2.toFixed(1)}</td>
        <td>${r1.toFixed(1)}</td><td>${r2.toFixed(1)}</td>
        <td>${intraday}</td>
        <td>${delivery}</td>
        <td>${gtt}</td>
        <td><a target="_blank" href="${chat}"><button>Ask</button></a></td>
      </tr>`;
    }catch(e){}
  }
}

loadData();
setInterval(loadData,60000);
</script>
</body>
</html>
