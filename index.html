<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Stock Dashboard with Date Picker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root {
  --bg:#0f172a; --card:#111827; --border:#1f2937;
  --text:#e5e7eb; --green:#22c55e; --red:#ef4444; --blue:#3b82f6;
}
body { margin:0; font-family:Arial; background:var(--bg); color:var(--text);}
header {background:#020617;padding:12px;border-bottom:1px solid var(--border);}
.topbar {display:flex;gap:15px;font-size:14px;flex-wrap:wrap;}
.badge {background:#1f2937;padding:6px 12px;border-radius:10px;}
.container {padding:16px;}
.card {background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;}
table {width:100%;border-collapse:collapse;}
th,td {padding:12px;border-bottom:1px solid var(--border);text-align:center;}
.pos {color:var(--green);font-weight:bold;}
.neg {color:var(--red);font-weight:bold;}
.controls {display:flex;gap:10px;margin-bottom:10px;flex-wrap:wrap;}
input,button {padding:8px 12px;border-radius:10px;border:none;font-size:14px;}
button {background:#1f2937;color:white;cursor:pointer;}
</style>
</head>

<body>

<header>
  <div class="topbar">
    <div class="badge">ðŸ“… Date:
      <input type="date" id="datePicker" style="background:#1f2937;color:white;border:none;padding:4px;border-radius:6px">
    </div>
  </div>
</header>

<div class="container">
  <div class="card">
    <h3>Historical Stock Data</h3>
    <table>
      <thead>
        <tr>
          <th>Stock</th>
          <th>Low</th>
          <th>High</th>
          <th>Close</th>
          <th>% Change</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
</div>

<script>
const stocks = ["IDEA","SBIN","TCS","RVNL","JPPOWER","HINDCOPPER","RBLBANK","HDFCBANK"];

document.getElementById("datePicker").valueAsDate = new Date();

// Convert date to Unix timestamp
function toUnix(dateStr) {
  return Math.floor(new Date(dateStr).getTime() / 1000);
}

// Fetch historical daily candle
async function fetchHistorical(symbol, date) {
  const start = toUnix(date) - 86400 * 2;
  const end   = toUnix(date) + 86400 * 2;

  const yahooUrl = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}.NS?period1=${start}&period2=${end}&interval=1d`;
  const proxy = "https://corsproxy.io/?";

  const res = await fetch(proxy + encodeURIComponent(yahooUrl));
  const json = await res.json();

  const result = json.chart.result?.[0];
  if (!result) return null;

  const quote = result.indicators.quote[0];
  const close = result.meta.previousClose;

  return {
    low: quote.low[quote.low.length-1],
    high: quote.high[quote.high.length-1],
    close: quote.close[quote.close.length-1],
    prevClose: close
  };
}

// Load table
async function loadData() {
  const date = document.getElementById("datePicker").value;
  const tbody = document.getElementById("tbody");
  tbody.innerHTML = "";

  for (let s of stocks) {
    try {
      const d = await fetchHistorical(s, date);
      if (!d) continue;

      const change = ((d.close - d.prevClose) / d.prevClose) * 100;
      const cls = change >= 0 ? "pos" : "neg";

      tbody.innerHTML += `
        <tr>
          <td>${s}</td>
          <td>${d.low.toFixed(2)}</td>
          <td>${d.high.toFixed(2)}</td>
          <td>${d.close.toFixed(2)}</td>
          <td class="${cls}">${change.toFixed(2)}%</td>
        </tr>
      `;
    } catch (e) {
      console.log("Error", s);
    }
  }
}

// Reload when date changes
document.getElementById("datePicker").addEventListener("change", loadData);

// Initial load
loadData();
</script>

</body>
</html>
