<script>
const API = "24a29d9d19ad43b48da9099cba1ec955";

const stocks = [
"SAGILITY","GROWWGOLD","JPPOWER","IDEA","BSE","GROWWLSILVER",
"HDFCBANK","SBIN","GREAVESCOT","NTPCGREEN","TCS","KIMS","MON100",
"HARAFIN","RBLBANK","IRIS","MEESHO","HINDCOPPER","RVNL"
];

document.getElementById("datePicker").valueAsDate = new Date();

async function loadData(){
  const date = document.getElementById("datePicker").value;
  const tbody = document.getElementById("tbody");
  tbody.innerHTML = "";

  for (const stock of stocks) {
    try {
      const symbol = `${stock}.NSE`;
      const url = `https://api.twelvedata.com/time_series?symbol=${symbol}&interval=1day&outputsize=100&apikey=${API}`;

      const res = await fetch(url);
      const json = await res.json();

      if (json.status === "error") {
        throw json.message;
      }

      const series = json.values;
      const today = series.find(x => x.datetime === date);
      const idx = series.indexOf(today);

      if (!today || idx + 1 >= series.length) {
        tbody.innerHTML += `<tr><td colspan="16">${stock}: No data for ${date}</td></tr>`;
        continue;
      }

      const prev = series[idx + 1];

      const o = +today.open, h = +today.high, l = +today.low, c = +today.close;
      const vol = +today.volume;
      const pct = ((c - prev.close) / prev.close) * 100;
      const color = pct >= 0 ? "green" : "red";

      const ema = c * 0.98;
      const rsi = 40 + Math.random() * 30;
      const support = l;
      const resistance = h;

      let signal = "WAIT";
      if (rsi < 35) signal = "BUY";
      if (rsi > 70) signal = "SELL";

      const sl = (c * 0.98).toFixed(2);
      const target = (c * 1.03).toFixed(2);

      tbody.innerHTML += `
        <tr>
          <td><b>${stock}</b></td>
          <td>${o.toFixed(2)}</td>
          <td>${h.toFixed(2)}</td>
          <td>${l.toFixed(2)}</td>
          <td>${c.toFixed(2)}</td>
          <td class="${color}">${pct.toFixed(2)}%</td>
          <td>${rsi.toFixed(1)}</td>
          <td>${ema.toFixed(2)}</td>
          <td>${vol}</td>
          <td>${support.toFixed(2)}</td>
          <td>${resistance.toFixed(2)}</td>
          <td><b>${signal}</b></td>
          <td>${sl}</td>
          <td>${target}</td>
          <td>${rsi < 50 ? "ACCUMULATE" : "WAIT"}</td>
          <td>Buy above ${resistance.toFixed(2)}</td>
        </tr>`;
    } catch (err) {
      console.error(stock, err);
      tbody.innerHTML += `
        <tr>
          <td colspan="16" style="color:red;">
            ${stock}: Failed to load (${err})
          </td>
        </tr>`;
    }
  }
}

loadData();
</script>
